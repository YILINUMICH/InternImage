# nuScenes Evaluation Experiments Configuration

experiment_name: "nuscenes_dcnv3_evaluation"
dataset: "nuscenes"

# Dataset configuration
data:
  root: "evaluation_framework/data/nuscenes"
  version: "v1.0-trainval"
  split: "val"
  num_samples: null  # null = use all samples
  cameras:
    - "CAM_FRONT"
    - "CAM_FRONT_LEFT"
    - "CAM_FRONT_RIGHT"
    - "CAM_BACK"
    - "CAM_BACK_LEFT"
    - "CAM_BACK_RIGHT"

# Models to evaluate
models:
  internimage_tiny:
    name: "InternImage-T"
    type: "internimage"
    backbone: "tiny"
    checkpoint: "evaluation_framework/models/pretrained/mask_rcnn_internimage_t_fpn_1x_coco.pth"
    config: "detection/configs/coco/mask_rcnn_internimage_t_fpn_1x_coco.py"
    
  internimage_small:
    name: "InternImage-S"
    type: "internimage"
    backbone: "small"
    checkpoint: "evaluation_framework/models/pretrained/mask_rcnn_internimage_s_fpn_1x_coco.pth"
    config: "detection/configs/coco/mask_rcnn_internimage_s_fpn_1x_coco.py"
  
  internimage_base:
    name: "InternImage-B"
    type: "internimage"
    backbone: "base"
    checkpoint: "evaluation_framework/models/pretrained/mask_rcnn_internimage_b_fpn_1x_coco.pth"
    config: "detection/configs/coco/mask_rcnn_internimage_b_fpn_1x_coco.py"
  
  # Baseline for comparison
  resnet50_baseline:
    name: "ResNet50-Baseline"
    type: "mask_rcnn"
    backbone: "resnet50"
    checkpoint: null
    config: "detection/configs/mask_rcnn/mask_rcnn_r50_fpn_1x_coco.py"

# Evaluation settings
evaluation:
  batch_size: 1
  num_workers: 4
  gpu_ids: [0]
  
  # nuScenes detection metrics
  metrics:
    - "mAP"
    - "NDS"  # nuScenes Detection Score
    - "mATE"  # Average Translation Error
    - "mASE"  # Average Scale Error
    - "mAOE"  # Average Orientation Error
    - "mAVE"  # Average Velocity Error
    - "mAAE"  # Average Attribute Error
  
  # Distance-based evaluation (nuScenes style)
  distance_bins:
    - [0, 20]      # Near
    - [20, 35]     # Medium
    - [35, 50]     # Far
    - [50, 100]    # Very far
  
  # nuScenes detection classes
  detection_classes:
    - "car"
    - "truck"
    - "bus"
    - "trailer"
    - "construction_vehicle"
    - "pedestrian"
    - "motorcycle"
    - "bicycle"
    - "traffic_cone"
    - "barrier"
  
  # Safety-critical classes
  safety_critical_classes:
    - "pedestrian"
    - "bicycle"
    - "motorcycle"
  
  # IoU thresholds
  iou_thresholds:
    - 0.5
    - 0.7

# FPS benchmarking
fps_benchmark:
  enabled: true
  num_warmup_iterations: 10
  num_test_iterations: 100
  batch_sizes: [1, 2, 4]
  input_resolutions:
    - [800, 1280]
    - [900, 1600]
  target_fps: 30

# Pedestrian-specific analysis
pedestrian_analysis:
  enabled: true
  distance_bins:
    - [0, 10, "Critical"]
    - [10, 20, "Near"]
    - [20, 40, "Medium"]
    - [40, 60, "Far"]
    - [60, 100, "Very Far"]
  
  visibility_levels:
    - "full"      # 80-100% visible
    - "most"      # 60-80% visible
    - "partial"   # 40-60% visible
    - "limited"   # <40% visible
  
  miss_rate_threshold: 0.10

# Cross-dataset evaluation
cross_dataset:
  enabled: false  # Set to true when running cross-dataset tests
  source_dataset: "waymo"  # Train on this
  target_dataset: "nuscenes"  # Test on this

# Visualization settings
visualization:
  enabled: true
  max_samples: 50
  save_predictions: true
  save_ground_truth: true
  output_format: "png"
  show_velocity_vectors: true
  show_3d_boxes: true

# Output settings
output:
  results_dir: "evaluation_framework/results/nuscenes"
  plots_dir: "evaluation_framework/results/nuscenes/plots"
  logs_dir: "evaluation_framework/results/nuscenes/logs"
  save_predictions: true
  save_analysis: true

# Experiment tracking
tracking:
  enabled: true
  use_tensorboard: true
  log_interval: 10
  
# nuScenes-specific settings
nuscenes_specific:
  use_lidar: false  # Camera-only evaluation
  use_radar: false
  predict_velocity: true
  predict_attributes: true
